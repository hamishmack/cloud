<!doctype html>
<html>
  <head>
    <meta charset=utf-8>
    <title>Sibyl</title>
    <style type="text/css">

      .content {
        margin: 0 auto;
        max-width: 50em;
      }

      .terminal {
        margin: 0 auto;
        max-width: 40em;
        background: #222;
        border-radius: 3px;
        padding: 1em;
      }

      .terminal pre {
        white-space: pre-wrap;
      }

      .stdout {
        color: #ddd;
      }

      .stderr {
        color: #ff7b7b;
      }
    </style>
  </head>
  <body>

    <div class="content">
    
    <p>Enter an address e.g. github://octocat/spoon-knife:</p>
    <form onsubmit="window.location = '/' + document.getElementById('address').value; return false">
      <input id='address'>
    </form>
    <p>Or have a look at these:</p>
    <ul>
      <li><a href="/github://octocat/spoon-knife">github://octocat/spoon-knife</a></li>
    </ul>

    <script>
      var address = window.location.pathname.substring(1);
      var query = window.location.search
      var eventSource = new EventSource('/~launch/' + address + query);

      var terminal = document.createElement('div');
      terminal.className = 'terminal';
      document.getElementsByTagName('body')[0].appendChild(terminal);

      eventSource.addEventListener('stdout', function(event) {
        var pre = document.createElement('pre');
        pre.className = 'stdout';
        pre.innerHTML = event.data;
        terminal.appendChild(pre);
      }, false);

      eventSource.addEventListener('stderr', function(event) {
        var pre = document.createElement('pre');
        pre.className = 'stderr';
        pre.innerHTML = event.data;
        terminal.appendChild(pre);
      }, false);

      eventSource.addEventListener('goto', function(event) {
        // Get the token
        var token = event.data

        var div = document.createElement('div');
        div.className = 'goto';
        div.innerHTML = '<a href="/~session/' + token + '/" target="_blank">Click here to open container</a>'
        document.getElementsByTagName('body')[0].appendChild(div);
      }, false);

      eventSource.addEventListener('end', function(event) {
        var div = document.createElement('div');
        div.className = 'end';
        document.getElementsByTagName('body')[0].appendChild(div);

        eventSource.close()
      }, false);

      eventSource.onerror = function(event) {
        console.error(event);
        eventSource.close();
      };
    </script>

    </div>

  </body>
</html>
